# Render Blueprint for Rakta-Webapp
# Deploy: Connect repo to Render and it will auto-detect this file
# Docs: https://docs.render.com/blueprint-spec

databases:
  - name: rakta-db
    databaseName: rakta
    user: rakta_user
    plan: basic-256mb # New flexible plan ($7/month). Use 'free' for testing

services:
  # ============================================
  # Backend - Spring Boot (Java 17)
  # ============================================
  - type: web
    name: rakta-backend
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: starter # $7/month
    healthCheckPath: /healthz
    envVars:
      # Port configuration (Render injects this)
      - key: PORT
        value: 8080
      # Spring profile
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      # Database - Render provides postgres:// connection string
      # Our entrypoint script parses this into SPRING_DATASOURCE_* vars
      - key: DATABASE_URL
        fromDatabase:
          name: rakta-db
          property: connectionString
      # JPA configuration
      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: update
      - key: SPRING_FLYWAY_ENABLED
        value: "false"
      # JWT Secret - MUST be set manually in Render dashboard
      - key: JWT_SECRET
        sync: false
      # OAuth2 (optional) - Set in dashboard if using Google login
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      # CORS - Update after custom domain setup
      - key: API_ALLOWED_ORIGINS
        value: https://rakta-frontend.onrender.com,https://sungchunn.com,https://www.sungchunn.com

  # ============================================
  # Frontend - Next.js 16 (React 19)
  # ============================================
  - type: web
    name: rakta-frontend
    runtime: docker
    dockerfilePath: ./frontend/Dockerfile
    dockerContext: ./frontend
    plan: starter # $7/month
    healthCheckPath: /
    envVars:
      # Port configuration (Render injects this)
      - key: PORT
        value: 3000
      # API URL - Update after custom domain setup
      # This is baked into the build, so redeploy after changing
      - key: NEXT_PUBLIC_API_URL
        value: https://rakta-backend.onrender.com/api
